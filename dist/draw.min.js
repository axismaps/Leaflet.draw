L.Draw={},L.Draw.Feature=L.Handler.extend({includes:L.Mixin.Events,initialize:function(a,b){this._map=a,this._container=a._container,this._overlayPane=a._panes.overlayPane,this._popupPane=a._panes.popupPane,b&&b.shapeOptions&&(b.shapeOptions=L.Util.extend({},this.options.shapeOptions,b.shapeOptions)),L.setOptions(this,b)},enable:function(){this._enabled||(L.Handler.prototype.enable.call(this),this.fire("enabled",{handler:this.type}),this._map.fire("draw:drawstart",{layerType:this.type}))},disable:function(){this._enabled&&(L.Handler.prototype.disable.call(this),this._map.fire("draw:drawstop",{layerType:this.type}),this.fire("disabled",{handler:this.type}))},addHooks:function(){var a=this._map;a&&(L.DomUtil.disableTextSelection(),a.getContainer().focus(),L.DomEvent.on(this._container,"keyup",this._cancelDrawing,this))},removeHooks:function(){this._map&&(L.DomUtil.enableTextSelection(),L.DomEvent.off(this._container,"keyup",this._cancelDrawing,this))},setOptions:function(a){L.setOptions(this,a)},_fireCreatedEvent:function(a){this._map.fire("draw:created",{layer:a,layerType:this.type})},_cancelDrawing:function(a){27===a.keyCode&&this.disable()}}),L.Draw.Marker=L.Draw.Feature.extend({statics:{TYPE:"marker"},options:{icon:new L.Icon.Default,repeatMode:!1,zIndexOffset:2e3},initialize:function(a,b){this.type=L.Draw.Marker.TYPE,L.Draw.Feature.prototype.initialize.call(this,a,b)},addHooks:function(){L.Draw.Feature.prototype.addHooks.call(this),this._map&&(this._mouseMarker||(this._mouseMarker=L.marker(this._map.getCenter(),{icon:L.divIcon({className:"leaflet-mouse-marker",iconAnchor:[20,20],iconSize:[40,40]}),opacity:0,zIndexOffset:this.options.zIndexOffset})),this._mouseMarker.on("click",this._onClick,this).addTo(this._map),this._map.on("mousemove",this._onMouseMove,this))},removeHooks:function(){L.Draw.Feature.prototype.removeHooks.call(this),this._map&&(this._marker&&(this._marker.off("click",this._onClick,this),this._map.off("click",this._onClick,this).removeLayer(this._marker),delete this._marker),this._mouseMarker.off("click",this._onClick,this),this._map.removeLayer(this._mouseMarker),delete this._mouseMarker,this._map.off("mousemove",this._onMouseMove,this))},_onMouseMove:function(a){var b=a.latlng;this._mouseMarker.setLatLng(b),this._marker?(b=this._mouseMarker.getLatLng(),this._marker.setLatLng(b)):(this._marker=new L.Marker(b,{icon:this.options.icon,zIndexOffset:this.options.zIndexOffset}),this._marker.on("click",this._onClick,this),this._map.on("click",this._onClick,this).addLayer(this._marker))},_onClick:function(){this._fireCreatedEvent(),this.disable(),this.options.repeatMode&&this.enable()},_fireCreatedEvent:function(){var a=new L.Marker(this._marker.getLatLng(),{icon:this.options.icon});L.Draw.Feature.prototype._fireCreatedEvent.call(this,a)}}),L.Draw.MarkerTouch=L.Draw.Marker.extend({initialize:function(a,b){L.Draw.Marker.prototype.initialize.call(this,a,b)},addHooks:function(){L.Draw.Marker.prototype.addHooks.call(this),L.DomEvent.addListener(this._map._container,"touchstart",this._onTouchStart,this),L.DomEvent.addListener(this._map._container,"touchmove",this._onTouchMove,this),L.DomEvent.addListener(this._map._container,"touchend",this._onTouchEnd,this)},removeHooks:function(){L.Draw.Marker.prototype.removeHooks.call(this),this._map&&(L.DomEvent.removeListener(this._map._container,"touchstart",this._onTouchStart,this),L.DomEvent.removeListener(this._map._container,"touchmove",this._onTouchMove,this),L.DomEvent.addListener(this._map._container,"touchend",this._onTouchEnd,this))},_normaliseEvent:function(a){L.DomUtil.disableImageDrag(),L.DomUtil.disableTextSelection();var b=a.touches?a.touches[0]:a,c=this._map.mouseEventToContainerPoint(b),d=this._map.mouseEventToLayerPoint(b),e=this._map.layerPointToLatLng(d);return{latlng:e,layerPoint:d,containerPoint:c,clientX:b.clientX,clientY:b.clientY,originalEvent:a}},_onTouchStart:function(a){if(1===a.touches.length){var b=this._normaliseEvent(a);this._currentLatLng=b.latlng,this._touchOriginPoint=L.point(b.clientX,b.clientY)}},_onTouchMove:function(a){if(this._touchOriginPoint){var b=this._normaliseEvent(a);this._touchEndPoint=L.point(b.clientX,b.clientY)}},_onTouchEnd:function(){if(this._touchOriginPoint)if(this._touchEndPoint){var a=L.point(this._touchEndPoint).distanceTo(this._touchOriginPoint);Math.abs(a)<9*(window.devicePixelRatio||1)&&this._fireTouchCreatedEvent()}else this._fireTouchCreatedEvent();this._touchOriginPoint=null,this._currentLatLng=null,this._touchEndPoint=null},_fireTouchCreatedEvent:function(){var a=new L.Marker(this._currentLatLng,{icon:this.options.icon});L.Draw.Feature.prototype._fireCreatedEvent.call(this,a),this.disable(),this.options.repeatMode&&this.enable()}}),L.Draw.Polyline=L.Draw.Feature.extend({statics:{TYPE:"polyline"},Poly:L.Polyline,options:{allowIntersection:!0,repeatMode:!1,drawError:{color:"#b00b00",timeout:2500},icon:new L.DivIcon({iconSize:new L.Point(10,10),className:"leaflet-div-icon leaflet-editing-icon"}),guidelineDistance:20,maxGuideLineLength:4e3,shapeOptions:{stroke:!0,color:"#f06eaa",weight:4,opacity:.5,fill:!1,clickable:!0},metric:!0,zIndexOffset:2e3},initialize:function(a,b){b&&b.drawError&&(b.drawError=L.Util.extend({},this.options.drawError,b.drawError)),this.type=L.Draw.Polyline.TYPE,L.Draw.Feature.prototype.initialize.call(this,a,b)},addHooks:function(){L.Draw.Feature.prototype.addHooks.call(this),this._map&&(this._markers=[],this._markerGroup=new L.LayerGroup,this._map.addLayer(this._markerGroup),this._poly=new L.Polyline([],this.options.shapeOptions),this._mouseMarker||(this._mouseMarker=L.marker(this._map.getCenter(),{icon:L.divIcon({className:"leaflet-mouse-marker",iconAnchor:[20,20],iconSize:[40,40]}),opacity:0,zIndexOffset:this.options.zIndexOffset})),this._mouseMarker.on("mousedown",this._onMouseDown,this).addTo(this._map),this._map.on("mousemove",this._onMouseMove,this).on("mouseup",this._onMouseUp,this).on("zoomend",this._onZoomEnd,this))},removeHooks:function(){L.Draw.Feature.prototype.removeHooks.call(this),this._clearHideErrorTimeout(),this._cleanUpShape(),this._map.removeLayer(this._markerGroup),delete this._markerGroup,delete this._markers,this._map.removeLayer(this._poly),delete this._poly,this._mouseMarker.off("mousedown",this._onMouseDown,this).off("mouseup",this._onMouseUp,this),this._map.removeLayer(this._mouseMarker),delete this._mouseMarker,this._clearGuides(),this._map.off("mousemove",this._onMouseMove,this).off("zoomend",this._onZoomEnd,this)},deleteLastVertex:function(){if(!(this._markers.length<=1)){var a=this._markers.pop(),b=this._poly,c=this._poly.spliceLatLngs(b.getLatLngs().length-1,1)[0];this._markerGroup.removeLayer(a),b.getLatLngs().length<2&&this._map.removeLayer(b),this._vertexChanged(c,!1)}},addVertex:function(a){this._markers.push(this._createMarker(a)),this._poly.addLatLng(a),2===this._poly.getLatLngs().length&&this._map.addLayer(this._poly),this._vertexChanged(a,!0)},_finishShape:function(){this._fireCreatedEvent(),this.disable(),this.options.repeatMode&&this.enable()},_shapeIsValid:function(){return!0},_onZoomEnd:function(){this._updateGuide()},_onMouseMove:function(a){var b=a.layerPoint,c=a.latlng;this._currentLatLng=c,this._updateGuide(b),this._mouseMarker.setLatLng(c),L.DomEvent.preventDefault(a.originalEvent)},_vertexChanged:function(){this._updateFinishHandler(),this._clearGuides()},_onMouseDown:function(a){var b=a.originalEvent;this._mouseDownOrigin=L.point(b.clientX,b.clientY)},_onMouseUp:function(a){if(this._mouseDownOrigin){var b=L.point(a.originalEvent.clientX,a.originalEvent.clientY).distanceTo(this._mouseDownOrigin);Math.abs(b)<9*(window.devicePixelRatio||1)&&this.addVertex(a.latlng)}this._mouseDownOrigin=null},_updateFinishHandler:function(){var a=this._markers.length;a>1&&this._markers[a-1].on("click",this._finishShape,this),a>2&&this._markers[a-2].off("click",this._finishShape,this)},_createMarker:function(a){var b=new L.Marker(a,{icon:this.options.icon,zIndexOffset:2*this.options.zIndexOffset});return this._markerGroup.addLayer(b),b},_updateGuide:function(a){var b=this._markers.length;b>0&&(a=a||this._map.latLngToLayerPoint(this._currentLatLng),this._clearGuides(),this._drawGuide(this._map.latLngToLayerPoint(this._markers[b-1].getLatLng()),a))},_drawGuide:function(a,b){var c,d,e,f=Math.floor(Math.sqrt(Math.pow(b.x-a.x,2)+Math.pow(b.y-a.y,2))),g=this.options.guidelineDistance,h=this.options.maxGuideLineLength,i=f>h?f-h:g;for(this._guidesContainer||(this._guidesContainer=L.DomUtil.create("div","leaflet-draw-guides",this._overlayPane));f>i;i+=this.options.guidelineDistance)c=i/f,d={x:Math.floor(a.x*(1-c)+c*b.x),y:Math.floor(a.y*(1-c)+c*b.y)},e=L.DomUtil.create("div","leaflet-draw-guide-dash",this._guidesContainer),e.style.backgroundColor=this._errorShown?this.options.drawError.color:this.options.shapeOptions.color,L.DomUtil.setPosition(e,d)},_updateGuideColor:function(a){if(this._guidesContainer)for(var b=0,c=this._guidesContainer.childNodes.length;c>b;b++)this._guidesContainer.childNodes[b].style.backgroundColor=a},_clearGuides:function(){if(this._guidesContainer)for(;this._guidesContainer.firstChild;)this._guidesContainer.removeChild(this._guidesContainer.firstChild)},_clearHideErrorTimeout:function(){this._hideErrorTimeout&&(clearTimeout(this._hideErrorTimeout),this._hideErrorTimeout=null)},_cleanUpShape:function(){this._markers.length>1&&this._markers[this._markers.length-1].off("click",this._finishShape,this)},_fireCreatedEvent:function(){var a=new this.Poly(this._poly.getLatLngs(),this.options.shapeOptions);L.Draw.Feature.prototype._fireCreatedEvent.call(this,a)}}),L.Draw.PolylineTouch=L.Draw.Polyline.extend({initialize:function(a,b){L.Draw.Polyline.prototype.initialize.call(this,a,b)},addHooks:function(){L.Draw.Polyline.prototype.addHooks.call(this),L.DomEvent.addListener(this._map._container,"touchstart",this._onTouchStart,this),L.DomEvent.addListener(this._map._container,"touchmove",this._onTouchMove,this),L.DomEvent.addListener(this._map._container,"touchend",this._onTouchEnd,this)},removeHooks:function(){L.Draw.Polyline.prototype.removeHooks.call(this),this._map&&(L.DomEvent.removeListener(this._map._container,"touchstart",this._onTouchStart,this),L.DomEvent.removeListener(this._map._container,"touchmove",this._onTouchMove,this),L.DomEvent.addListener(this._map._container,"touchend",this._onTouchEnd,this))},_normaliseEvent:function(a){L.DomUtil.disableImageDrag(),L.DomUtil.disableTextSelection();var b=a.touches?a.touches[0]:a,c=this._map.mouseEventToContainerPoint(b),d=this._map.mouseEventToLayerPoint(b),e=this._map.layerPointToLatLng(d);return{latlng:e,layerPoint:d,containerPoint:c,clientX:b.clientX,clientY:b.clientY,originalEvent:a}},_updateFinishHandler:function(){L.Draw.Polyline.prototype._updateFinishHandler.call(this);var a,b,c=this._markers.length,d=this._map.containerPointToLatLng([0,0]).distanceTo(this._map.containerPointToLatLng([0,1]));c>2&&(a=this._markers[c-2].getLatLng().distanceTo(this._markers[c-1].getLatLng()),b=Math.floor(a/d),b<12*(window.devicePixelRatio||1)&&(this.deleteLastVertex(),this._finishShape()))},_onTouchStart:function(a){if(1===a.touches.length){var b=this._normaliseEvent(a);this._currentLatLng=b.latlng,this._touchOriginPoint=L.point(b.clientX,b.clientY)}},_onTouchMove:function(a){if(this._touchOriginPoint){var b=this._normaliseEvent(a);this._touchEndPoint=L.point(b.clientX,b.clientY)}},_onTouchEnd:function(){if(this._touchOriginPoint)if(this._touchEndPoint){var a=L.point(this._touchEndPoint).distanceTo(this._touchOriginPoint);Math.abs(a)<9*(window.devicePixelRatio||1)&&this.addVertex(this._currentLatLng)}else this.addVertex(this._currentLatLng);this._touchOriginPoint=null,this._touchEndPoint=null}}),L.Draw.Polygon=L.Draw.Polyline.extend({statics:{TYPE:"polygon"},Poly:L.Polygon,options:{showArea:!1,shapeOptions:{stroke:!0,color:"#f06eaa",weight:4,opacity:.5,fill:!0,fillColor:null,fillOpacity:.2,clickable:!0}},initialize:function(a,b){L.Draw.Polyline.prototype.initialize.call(this,a,b),this.type=L.Draw.Polygon.TYPE},_updateFinishHandler:function(){var a=this._markers.length;a>3&&(this._markers[0].on("click",this._finishShape,this),this._markers[a-1].on("dblclick",this._finishShape,this),a>3&&this._markers[a-2].off("dblclick",this._finishShape,this))},_shapeIsValid:function(){return this._markers.length>=3},_vertexChanged:function(a,b){var c;!this.options.allowIntersection&&this.options.showArea&&(c=this._poly.getLatLngs(),this._area=L.GeometryUtil.geodesicArea(c)),L.Draw.Polyline.prototype._vertexChanged.call(this,a,b)},_cleanUpShape:function(){var a=this._markers.length;a>0&&(this._markers[0].off("click",this._finishShape,this),a>2&&this._markers[a-1].off("dblclick",this._finishShape,this))}}),L.Draw.PolygonTouch=L.Draw.Polygon.extend({initialize:function(a,b){L.Draw.Polygon.prototype.initialize.call(this,a,b)},addHooks:function(){L.Draw.Polygon.prototype.addHooks.call(this),L.DomEvent.addListener(this._map._container,"touchstart",this._onTouchStart,this),L.DomEvent.addListener(this._map._container,"touchmove",this._onTouchMove,this),L.DomEvent.addListener(this._map._container,"touchend",this._onTouchEnd,this)},removeHooks:function(){L.Draw.Polygon.prototype.removeHooks.call(this),this._map&&(L.DomEvent.removeListener(this._map._container,"touchstart",this._onTouchStart,this),L.DomEvent.removeListener(this._map._container,"touchmove",this._onTouchMove,this),L.DomEvent.addListener(this._map._container,"touchend",this._onTouchEnd,this))},_normaliseEvent:function(a){L.DomUtil.disableImageDrag(),L.DomUtil.disableTextSelection();var b=a.touches?a.touches[0]:a,c=this._map.mouseEventToContainerPoint(b),d=this._map.mouseEventToLayerPoint(b),e=this._map.layerPointToLatLng(d);return{latlng:e,layerPoint:d,containerPoint:c,clientX:b.clientX,clientY:b.clientY,originalEvent:a}},_updateFinishHandler:function(){L.Draw.Polygon.prototype._updateFinishHandler.call(this);var a,b,c=this._markers.length,d=this._map.containerPointToLatLng([0,0]).distanceTo(this._map.containerPointToLatLng([0,1]));c>3&&(a=this._markers[0].getLatLng().distanceTo(this._markers[c-1].getLatLng()),b=Math.floor(a/d),b<12*(window.devicePixelRatio||1)&&(this.deleteLastVertex(),this._finishShape()))},_onTouchStart:function(a){if(1===a.touches.length){var b=this._normaliseEvent(a);this._currentLatLng=b.latlng,this._touchOriginPoint=L.point(b.clientX,b.clientY)}},_onTouchMove:function(a){if(this._touchOriginPoint){var b=this._normaliseEvent(a);this._touchEndPoint=L.point(b.clientX,b.clientY)}},_onTouchEnd:function(){if(this._touchOriginPoint)if(this._touchEndPoint){var a=L.point(this._touchEndPoint).distanceTo(this._touchOriginPoint);Math.abs(a)<9*(window.devicePixelRatio||1)&&this.addVertex(this._currentLatLng)}else this.addVertex(this._currentLatLng);this._touchOriginPoint=null,this._touchEndPoint=null}});